# EdTech Kurikulum Merdeka - Environment Variables Template
# Copy this file to .env.local and fill in your actual values
# IMPORTANT: Never commit .env.local to git. Add to .gitignore

# ===== FIREBASE CONFIGURATION =====
# Get these from Firebase Console > Project Settings

# Client-side PUBLIC variables (safe to expose)
NEXT_PUBLIC_FIREBASE_API_KEY=your_api_key
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_auth_domain
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your_storage_bucket
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
NEXT_PUBLIC_FIREBASE_APP_ID=your_app_id

# Application URL (for email verification links, OAuth redirects)
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Server-side only (NEVER expose to client)
# Get from Firebase Console > Project Settings > Service Accounts
FIREBASE_ADMIN_PROJECT_ID=your_project_id
FIREBASE_ADMIN_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your-project.iam.gserviceaccount.com
FIREBASE_ADMIN_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"

# ===== GEMINI API CONFIGURATION =====
# Get from https://makersuite.google.com/app/apikey
# Multiple keys for redundancy and quota management

GEMINI_API_KEYS=key1,key2,key3

# Optional: Specific model configuration
GEMINI_DEFAULT_MODEL=gemini-1.5-pro

# ===== EMAIL CONFIGURATION =====
# For sending verification emails (optional)
# Falls back to console logging if not configured

SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password

# For Gmail: Generate App Password at https://myaccount.google.com/apppasswords

# ===== REDIS RATE LIMITING (PRODUCTION) =====
# For distributed rate limiting across multiple servers
# Get from https://console.upstash.com/redis

UPSTASH_REDIS_REST_URL=https://your-region-your-id.upstash.io
UPSTASH_REDIS_REST_TOKEN=your_redis_token

# ===== RATE LIMITING CONFIGURATION =====
# Settings for per-user API rate limiting

RATE_LIMIT_WINDOW_MS=60000              # 1 minute sliding window
RATE_LIMIT_MAX_REQUESTS_TP=5            # Generate TP: 5 req/min
RATE_LIMIT_MAX_REQUESTS_SOAL=5          # Generate Soal: 5 req/min
RATE_LIMIT_MAX_REQUESTS_KOREKSI=10      # Koreksi: 10 req/min
RATE_LIMIT_MAX_REQUESTS_EXPORT=5        # Rekap Nilai Export: 5 req/min
RATE_LIMIT_MAX_REQUESTS_VERIFY=3        # Email Verify: 3 req/day

# ===== SECURITY CONFIGURATION =====

# CSRF Token settings
CSRF_TOKEN_EXPIRY_MS=3600000            # 1 hour

# Session timeout
SESSION_TIMEOUT_MS=1800000              # 30 minutes

# ===== LOGGING & MONITORING =====

# Enable audit logging for security events
ENABLE_AUDIT_LOG=true

# Log level: development | test | production
LOG_LEVEL=info

# ===== FEATURE FLAGS =====
# Enable/disable security features

ENABLE_EMAIL_VERIFICATION=true
ENABLE_CSRF_PROTECTION=true
ENABLE_RATE_LIMITING=true
ENABLE_AUDIT_LOGGING=true

# ===== SECURITY NOTES =====
# 
# 1. DEVELOPMENT vs PRODUCTION
#    Development:
#    - In-memory rate limiting (resets on restart)
#    - Console email logging
#    - Verbose error messages
#    
#    Production:
#    - Redis rate limiting (persistent)
#    - SMTP email sending
#    - Generic error messages
#
# 2. ENVIRONMENT VARIABLES CHECKLIST
#    Required (both dev & prod):
#    - NEXT_PUBLIC_FIREBASE_API_KEY
#    - FIREBASE_ADMIN_PROJECT_ID
#    - FIREBASE_ADMIN_CLIENT_EMAIL
#    - FIREBASE_ADMIN_PRIVATE_KEY
#    - GEMINI_API_KEYS
#
#    Required (production only):
#    - UPSTASH_REDIS_REST_URL
#    - UPSTASH_REDIS_REST_TOKEN
#    - SMTP_HOST, SMTP_USER, SMTP_PASS
#    - NEXT_PUBLIC_APP_URL (production URL)
#
# 3. TESTING ENDPOINTS AFTER SETUP
#    Run: npm run dev
#    Test auth: curl http://localhost:3000/api/quota-status
#    Test rate limit: curl http://localhost:3000/api/generate-tp (5x)
#    Check audit: Firebase Console > Firestore > audit_logs
#
# 4. TROUBLESHOOTING
#    "Module not found: @/lib/..."
#    → Ensure FIREBASE_ADMIN_PRIVATE_KEY is properly escaped
#
#    "Quota exceeded"
#    → Wait 1-5 minutes or add new GEMINI_API_KEY
#
#    "Email not sending"
#    → Check SMTP_HOST, SMTP_USER, SMTP_PASS
#    → For Gmail: Use App Passwords only
#    → Check console logs for SMTP errors
